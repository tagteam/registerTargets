#+TITLE: PhD course: Targeted Register Analysis: Exercises: Day 3 part 3

* Objectives

The learning targets of this exercise are:

- to add penalized logistic regression models to the super learner

** Reading references

- https://glmnet.stanford.edu/articles/glmnet.html

----------------------------------------------------------------------  

* Penalized logistic regression

- The function =glmnet= implements LASSO (alpha=1), ridge regression
  (alpha=0) and the elastic net (alpha between 0 and 1). Add the
  following targets to the pipeline and call =tar_make()=

#+BEGIN_SRC R  :results output raw  :exports code  :session *R* :cache yes  
tar_target(ltmle_glmnet_solo_death_1,
           run_Ltmle(name_outcome="Dead",
                     name_censoring = "Censored",
                     censored_label = 0,
                     time_horizon=1,
                     outcome_data=survival_outcome_data,
                     regimen_data=list(Drug = regimen_data),
                     baseline_data=baseline_covariates,
                     timevar_data=time_covariates,
                     abar = list(control = 0,treat = 1),
                     SL.library="glmnet",
                     SL.cvControl = list(selector="optimize",alpha=0.5),
                     verbose=TRUE))

#+END_SRC  

- Consider the log-odds ratios of the propensity score model

#+BEGIN_SRC R  :results output raw  :exports code  :session *R* :cache yes  
tar_load(ltmle_glmnet_solo_death_1)
ltmle_glmnet_solo_death_1[[1]][[1]]$Ltmle_fit$fit$g
#+END_SRC

- Add SL.glmnet to superlearner:

#+BEGIN_SRC R  :results output raw  :exports code  :session *R* :cache yes  
tar_target(ltmle_glmnet_death_1,
           run_Ltmle(name_outcome="Dead",
                     name_censoring = "Censored",
                     censored_label = 0,
                     time_horizon=1,
                     outcome_data=survival_outcome_data,
                     regimen_data=list(Drug = regimen_data),
                     baseline_data=baseline_covariates,
                     timevar_data=time_covariates,
                     abar = list(control = 0,treat = 1),
                     SL.library=c("SL.glm","SL.glm.interaction","SL.glmnet"),
                     SL.cvControl = list(V=2),
                     verbose=TRUE))

#+END_SRC    

- Add targets that calculate the summary tables and compare the
  results to the previous results of the superlearner without glmnet

